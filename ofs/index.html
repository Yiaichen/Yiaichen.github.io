<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Vayi" href="http://vayi.site/rss.xml"><link rel="alternate" type="application/atom+xml" title="Vayi" href="http://vayi.site/atom.xml"><link rel="alternate" type="application/json" title="Vayi" href="http://vayi.site/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Linux"><link rel="canonical" href="http://vayi.site/ofs/"><title>ofs1.5 部署 - Linux | Vayi Blog = Vayi</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">ofs1.5 部署</h1><div class="meta"><span class="item" title="创建时间：2019-12-25 10:33:58"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2019-12-25T10:33:58+08:00">2019-12-25</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>7.2k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>7 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Vayi Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://pic1.zhimg.com/v2-b0539fa55f6d5a99536e706895465563_r.jpg?source=2c26e567"></li><li class="item" data-background-image="https://picx.zhimg.com/v2-ff4cee364d67ee859c38a583907ad74a_r.jpg?source=2c26e567"></li><li class="item" data-background-image="https://picx.zhimg.com/v2-304a00310f886e7f23b40d4e62a94dd6_r.jpg?source=2c26e567"></li><li class="item" data-background-image="https://pic1.zhimg.com/v2-b0539fa55f6d5a99536e706895465563_r.jpg?source=2c26e567"></li><li class="item" data-background-image="https://picx.zhimg.com/v2-6eb12b5b0935f78b612232382ea7697b_r.jpg?source=2c26e567"></li><li class="item" data-background-image="https://pic1.zhimg.com/v2-1c14d5734016d8bfea115531f94b0227_r.jpg?source=2c26e567"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Linux/" itemprop="item" rel="index" title="分类于 Linux"><span itemprop="name">Linux</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://vayi.site/ofs/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="vayi"><meta itemprop="description" content=", vayi's blog~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Vayi"></span><div class="body md" itemprop="articleBody"><h3 id="服务器配置推荐"><a class="anchor" href="#服务器配置推荐">#</a> 服务器配置（推荐）</h3><table><thead><tr><th style="text-align:center">服务器类型</th><th style="text-align:center">数量 / 台</th><th style="text-align:center">CPU</th><th style="text-align:center">内存</th><th style="text-align:center">系统磁盘</th><th style="text-align:center">数据磁盘</th><th style="text-align:center">网络带宽</th><th style="text-align:center">操作系统</th></tr></thead><tbody><tr><td style="text-align:center">应用服务器</td><td style="text-align:center">1</td><td style="text-align:center">8 核</td><td style="text-align:center">32G</td><td style="text-align:center">40G</td><td style="text-align:center">300G SSD</td><td style="text-align:center">4M</td><td style="text-align:center">Ubuntu Server 16.04</td></tr><tr><td style="text-align:center">接口服务器</td><td style="text-align:center">1</td><td style="text-align:center">4 核</td><td style="text-align:center">16G</td><td style="text-align:center">40G</td><td style="text-align:center">300G SSD</td><td style="text-align:center">5M</td><td style="text-align:center">Ubuntu Server 16.04</td></tr><tr><td style="text-align:center">RDS 数据库 (高可用版)</td><td style="text-align:center">1</td><td style="text-align:center">8 核</td><td style="text-align:center">32G</td><td style="text-align:center">/</td><td style="text-align:center">1T SSD</td><td style="text-align:center">/</td><td style="text-align:center">Mysql 5.7</td></tr><tr><td style="text-align:center">基础服务器</td><td style="text-align:center">1</td><td style="text-align:center">4 核</td><td style="text-align:center">16G</td><td style="text-align:center">40G</td><td style="text-align:center">500G SSD</td><td style="text-align:center">2M</td><td style="text-align:center">Ubuntu Server 16.04</td></tr><tr><td style="text-align:center">报表服务器</td><td style="text-align:center">1</td><td style="text-align:center">4 核</td><td style="text-align:center">16G</td><td style="text-align:center">40G</td><td style="text-align:center">200G</td><td style="text-align:center">2M</td><td style="text-align:center">Ubuntu Server 16.04</td></tr><tr><td style="text-align:center">测试服务器</td><td style="text-align:center">1</td><td style="text-align:center">4 核</td><td style="text-align:center">16G</td><td style="text-align:center">40G</td><td style="text-align:center">500G</td><td style="text-align:center">2M</td><td style="text-align:center">Ubuntu Server 16.04</td></tr><tr><td style="text-align:center">测试 RDS 数据库 (高可用版)</td><td style="text-align:center">1</td><td style="text-align:center">4 核</td><td style="text-align:center">16G</td><td style="text-align:center">/</td><td style="text-align:center">500G SSD</td><td style="text-align:center">/</td><td style="text-align:center">Mysql 5.7</td></tr></tbody></table><blockquote><p>备注：如果有京东平台业务，还需加购一台同等配置京东云鼎 ECS 服务器、京东云鼎 RDS 服务器</p></blockquote><h3 id="服务器类型"><a class="anchor" href="#服务器类型">#</a> 服务器类型</h3><table><thead><tr><th style="text-align:center">服务器类型</th><th style="text-align:center">部署应用</th></tr></thead><tbody><tr><td style="text-align:center">应用服务器</td><td style="text-align:center">ofs</td></tr><tr><td style="text-align:center">接口服务器</td><td style="text-align:center">各种 edi</td></tr><tr><td style="text-align:center">RDS 数据库 (高可用版)</td><td style="text-align:center">mysql</td></tr><tr><td style="text-align:center">基础服务器</td><td style="text-align:center">redis、mongoDB、rabbitMQ</td></tr><tr><td style="text-align:center">报表服务器</td><td style="text-align:center">ofs (只给报表类功能使用)</td></tr><tr><td style="text-align:center">测试服务器</td><td style="text-align:center">所有应用</td></tr><tr><td style="text-align:center">测试 RDS 数据库 (高可用版)</td><td style="text-align:center">mysql</td></tr></tbody></table><blockquote><p>&lt;font color=#DC143C&gt;<strong> 以下流程仅以测试服务器做演示，生产服务器以上述表格为标准，具体根据项目情况进行改动</strong> &lt;/font&gt;</p></blockquote><h3 id="添加用户"><a class="anchor" href="#添加用户">#</a> 添加用户</h3><blockquote><p>系统必须在 ttx 用户下运行，所以需要为新系统添加 ttx 用户</p></blockquote><blockquote><p>以下操作以 root 用户权限执行</p></blockquote><ul><li><p>新建用户并指定用户目录</p><pre><code>useradd -d /home/ttx -m ttx
passwd ttx
</code></pre><blockquote><p>用户密码重启之后才会生效</p></blockquote></li><li><p>赋予 sudo 权限</p><pre><code>vi /etc/sudoers
</code></pre><blockquote><p>在 root 下添加一行，如下所示</p></blockquote><blockquote><p>[注意] 此文件为只读文件，请保存时使用: <code>wq!</code> 命令</p></blockquote><pre><code># User privilege specification
root    ALL=(ALL:ALL) ALL
ttx     ALL=(ALL:ALL) ALL
</code></pre><blockquote><p>[可选] 修改新建用户的 Shell 类型</p></blockquote><blockquote><p>找到 ttx 的一行，检查是否与下面一致，如不一致，修改</p></blockquote><pre><code>root@iZ8vbeurni16yy34ptzcdzZ:/# vi /etc/passwd
ttx:x:1000:1000::/home/ttx:/bin/bash
</code></pre></li><li><p>创建应用主目录</p><pre><code>mkdir /home/ttx/app
</code></pre></li></ul><h3 id="挂载数据盘"><a class="anchor" href="#挂载数据盘">#</a> 挂载数据盘</h3><pre><code>仅针对数据盘默认未挂载的情况，比如阿里云。(这里以50G数据盘做演示)
以下操作以root用户权限执行
</code></pre><ul><li><p>查看设备目录，通常数据盘为 <code>/dev/vdb</code></p><pre><code>fdisk -l
</code></pre><p><img data-src="http://img.localhostes.com/images/2019/12/22/fdiskbefore.png" alt="image"></p></li><li><p>创建分区</p><pre><code>fdisk /dev/vdb
</code></pre><blockquote><p>根据提示，依次输入<strong> n-&gt;p-&gt;1-&gt; 回车 -&gt; 回车 -&gt;wq</strong> 成功后会有以下输出</p></blockquote><p><img data-src="http://img.localhostes.com/images/2019/12/22/fdisk.png" alt="image"></p><blockquote><p>检查分区是否创建成功</p></blockquote><pre><code>fdisk -l
</code></pre><p><img data-src="http://img.localhostes.com/images/2019/12/22/fdiskafter.png" alt="image"></p><blockquote></blockquote></li><li><p>格式化</p><pre><code>mkfs.ext4 /dev/vdb1
</code></pre><p><img data-src="http://img.localhostes.com/images/2019/12/22/mkfs.png" alt="image"></p></li><li><p>挂载数据盘</p><pre><code>chown ttx:ttx home/ttx/app/
mount /dev/vdb1 /home/ttx/app
</code></pre><blockquote><p>检查挂载结果 <code>df -h</code></p></blockquote><p><img data-src="http://img.localhostes.com/images/2019/12/22/df-h.png" alt="image"></p></li><li><p>设置自动挂载（请根据实际挂载硬盘参数对下面命令做适当修改）</p><pre><code>echo '/dev/vdb1 /home/ttx/app ext4 defaults 0 0 ' &gt;&gt;/etc/fstab  
</code></pre></li></ul><h3 id="安装基础运行环境"><a class="anchor" href="#安装基础运行环境">#</a> 安装基础运行环境</h3><h4 id="准备工作"><a class="anchor" href="#准备工作">#</a> 准备工作</h4><ul><li>以创建好的 <code>ttx</code> 身份进行登录</li><li>创建存放安装包的目录: <code>mkdir /home/ttx/installer</code></li><li>准备好<span class="exturl" data-url="aHR0cDovL3d3dy5iYWlkdS5jb20=">安装包</span></li></ul><h4 id="安装docker"><a class="anchor" href="#安装docker">#</a> 安装 docker</h4><ul><li><p>使用阿里解决方案 安装 <code>docker-engine</code></p><pre><code># [docker-engine已停止支持，请使用以下脚本安装]

# step 1: 安装必要的一些系统工具
sudo apt-get update
sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common
# step 2: 安装GPG证书
curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
# Step 3: 写入软件源信息
sudo add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;
# Step 4: 更新并安装 Docker-CE
sudo apt-get -y update
sudo apt-get -y install docker-ce

# https://help.aliyun.com/document_detail/60742.html
</code></pre><blockquote><p>注意：如果 curl 不存在，请使用以下命令安装</p></blockquote><pre><code>sudo apt-get install curl
</code></pre><blockquote><p><strong>非必要流程</strong> 修改 daemon 配置文件 <code>/etc/docker/daemon.json</code> 来使用加速器</p></blockquote><pre><code>sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-EOF
&#123;
  &quot;registry-mirrors&quot;: [&quot;https://gkhkf8gb.mirror.aliyuncs.com&quot;]
&#125;
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre><p><img data-src="http://img.localhostes.com/images/2019/12/22/EOF.png" alt="image"></p></li><li><p>将用户 ttx 加入允许执行 docker 组</p><pre><code>sudo usermod -aG docker ttx
</code></pre></li></ul><h4 id="安装docker-compose"><a class="anchor" href="#安装docker-compose">#</a> 安装 docker-compose</h4><ul><li><p>上传 <code>docker-compose-Linux-x86_64.1.7.1</code> 文件到 <code>/home/ttx/installer</code> 也可以下载最新版本</p><pre><code>sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.23.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose`
</code></pre></li><li><p>执行以下脚本安装</p><blockquote><p>安装</p></blockquote><pre><code>cd /home/ttx/installer
#复制并重命名
sudo cp docker-compose-Linux-x86_64.1.7.1 /usr/local/bin/docker-compose
#更改文件权限使其可以执行　+x　代表执行权限
sudo chmod +x /usr/local/bin/docker-compose  
</code></pre><blockquote><p>检查安装结果</p></blockquote><pre><code>ttx@iZ8vbeurni16yy34ptzcdzZ:/# docker-compose --version
docker-compose version 1.7.1, build 0a9ab35
</code></pre></li></ul><h4 id="mongo-rabbit-redis-mysql"><a class="anchor" href="#mongo-rabbit-redis-mysql">#</a> mongo、rabbit、redis、mysql</h4><blockquote><p>创建镜像存放目录</p></blockquote><pre><code>sudo mkdir /home/ttx/installer/images
sudo mkdir /home/ttx/installer/compose
</code></pre><ul><li><p>上传镜像</p><ul><li>上传对应的镜像文件到 <code>/home/ttx/installer/images</code></li><li>上传 compose.zip 到 <code>/home/ttx/installer/compose</code></li></ul></li><li><p>安装镜像</p><ul><li>执行以下脚本装载镜像</li></ul><pre><code>cd /home/ttx/installer/images
sudo docker load &lt; mongo_3.2.4.tar
sudo docker load &lt; rabbitmq_3.6.1-management.tar
sudo docker load &lt; redis_3.2.0.tar
#仅当mysql在容器中运行时才运行以下命令
sudo docker load &lt; mysql_5.7.11.tar
</code></pre></li><li><p>启动服务 分别进入每一个容器目录，执行以下脚本</p><pre><code>sudo docker-compose up -d
</code></pre><blockquote><p>检查镜像是否创建成功 <code>docker ps</code></p></blockquote><p><img data-src="http://img.localhostes.com/images/2019/12/22/dockerps.png" alt="image"></p><ul><li><p>注意：MySql 参数设置在 <code>/etc/my.cnf</code> 中的 <code>[mysqld]</code> 后添加以下段：</p><ul><li>使用 utf-8 编码： <code>character-set-server=utf8</code></li><li>表不区分大小写： <code>lower_case_table_names=1</code></li><li>分组连接最大长度： <code>group_concat_max_len=102400</code></li><li>缓冲池字节大小： <code>innodb_buffer_pool_size = 数据库内存一半</code></li></ul></li><li><p>注意：创建 rabbitMQ 的 <code>虚拟主机(VirtualHost)</code> 新安装的 rabbitMQ 必须新建主机，不允许使用默认的。新主机名称为 <code>企业ID</code> ，企业 ID 的格式为 <code>4位项目编码 + ofs +xxxx</code> ，其中 xxxx 为 <code>prod</code> 或者 <code>test</code> 登录 <code>http://服务器地址:35673</code> 进行创建，创建后将主机权限赋予 ttx 用户</p></li></ul></li></ul><h4 id="tomcat"><a class="anchor" href="#tomcat">#</a> tomcat</h4><blockquote><p>以下操作以 ttx 用户权限执行</p></blockquote><ul><li>上传<strong> tomcat-deploy-1.6.zip 到 /home/ttx/installer</strong> 目录下<ul><li><p>解压缩</p><pre><code>sudo unzip ./tomcat-deploy-1.6.zip -d /home/ttx/app/tomcat-deploy
</code></pre></li><li><p>创建系统环境</p><blockquote><p>运行前请检查 <code>set_env.py</code> 中 <code>APP_HOME</code> 的目录是否正确，应为 <code>/home/ttx/app/</code></p></blockquote><pre><code>cd /home/ttx/app/tomcat-deploy
python install_env.py
</code></pre></li></ul></li></ul><blockquote><p>如果服务器上没有 python 命令，而只有 python3，则使用 python3 代替</p></blockquote><h4 id="nginx"><a class="anchor" href="#nginx">#</a> nginx</h4><blockquote><p>以下操作以 ttx 用户权限执行</p></blockquote><ul><li>上传<strong> nginx-1.11.6.tar.gz 到 /home/ttx/installer</strong> 目录下</li><li>执行以下脚本安装<pre><code>sudo apt-get install build-essential  libpcre3-dev libssl-dev
sudo tar -zxvf /home/ttx/installer/nginx-1.11.6.tar.gz -C /home/ttx/app/
cd /home/ttx/app
cd nginx-1.11.6
#对nginx进行配置
sudo ./configure --with-http_ssl_module --prefix=/home/ttx/app/nginx/
#编译安装
sudo make &amp;&amp; make install
cd /home/ttx/app/nginx
# 备份配置文件
sudo mv conf/nginx.conf conf/nginx.conf.backup
sudo mkdir webapps
</code></pre></li></ul><blockquote><p>tar 命令如果不存在的话先下载</p></blockquote><blockquote><p>如果服务器上没有 python 命令，而只有 python3，则使用 python3 代替</p></blockquote><ul><li><p>上传配置文件 <code>nginx.conf</code> 和 <code>proxy.conf</code> 到 <code>/home/ttx/app/nginx/conf/</code> 目录下</p></li><li><p>在<span class="exturl" data-url="aHR0cDovL25leHVzLmN5YmVydHJhbnMuaXR0eC5jb20uY24v"> nexus</span> 上下载对应的 <code>cbt-web</code> (这里以 <code>cbt-web-2.5.12</code> 做演示)</p><ul><li><p>搜索 <code>cbt-web-2.5.12</code><br><img data-src="http://img.localhostes.com/images/2019/12/23/nexus.png" alt="image"></p></li><li><p>点击对应版本<br><img data-src="http://img.localhostes.com/images/2019/12/23/seach.png" alt="image"></p></li><li><p>下载 cbt_web 压缩包<br><img data-src="http://img.localhostes.com/images/2019/12/23/download.png" alt="image"></p></li><li><p>把压缩包上传到服务器 <code>/home/ttx/app/nginx/webapps/ofs1_5/</code> 目录下</p><pre><code>cd /home/ttx/app/nginx/webapps/
# 创建ofs1_5文件夹
sudo mkdir ofs1_5

# 执行上传操作 ... ...

# 解压cbt-web
sudo tar -zxvf cbt-web-2.5.12-20190718.063712-5.tar.gz
</code></pre></li></ul></li><li><p>测试并启动 <code>nginx</code></p><pre><code> cd /home/ttx/app/nginx/sbin
 #测试nginx配置文件
 sudo ./nginx -t
 #启动　nginx
 sudo ./nginx
</code></pre><blockquote><p>Nginx 配置没问题会有以下输出</p></blockquote><p><img data-src="http://img.localhostes.com/images/2019/12/23/93ZTJ882G88VANDT5G.png" alt="image"></p><blockquote><p><strong>注意：</strong> 使用以下命令重启 Nginx 服务</p></blockquote><pre><code>sudo ./nginx -s reload
</code></pre></li><li><p>检查是否启动成功</p><ul><li>在浏览器输入 <code>http://服务器地址:30001/</code></li><li>有以下展示就说明 Nginx 已经配置成功了<br><img data-src="http://img.localhostes.com/images/2019/12/23/XKCNLIN1M49SFEC3.png" alt="image"></li></ul></li></ul><h3 id="准备程序环境"><a class="anchor" href="#准备程序环境">#</a> 准备程序环境</h3><blockquote><p>准备程序的部署目录和运行目录 (下述以 <code>ofs1_5</code> 、 <code>license</code> 演示)</p></blockquote><pre><code>cd /home/ttx/app/tomcat-deploy
python install_app.py license 30008
# 比如内存限制为最低1g，最高4g
python install_app.py ofs1_5 9005 1g 4g
</code></pre><blockquote><p>注意：如果服务器上没有 python 命令，而只有 python3，则执行以下命令</p></blockquote><pre><code>cd /home/ttx/app/tomcat-deploy
python3 install_app.py license 30008
# 比如内存限制为最低1g，最高4g
python3 install_app.py ofs1_5 9005 1g 4g
</code></pre><h3 id="安装license服务"><a class="anchor" href="#安装license服务">#</a> 安装 license 服务</h3><ul><li><p>上传 license.zip 文件到 /home/ttx/app/license/upload 目录</p></li><li><p>执行命令</p><pre><code>sudo chmod +x /home/ttx/app/jre/lib/amd64/*
</code></pre></li><li><p>创建执行脚本</p><pre><code>cd /home/ttx/app/license
sudo echo &quot;export LD_LIBRARY_PATH=/home/ttx/app/jre/lib/amd64 &amp;&amp; nohup /home/ttx/app/jre/bin/java -jar /home/ttx/app/license/upload/license.zip &amp;&quot; &gt; run.sh
sudo chmod +x run.sh
</code></pre></li><li><p>启动 license 服务</p><pre><code>sh ./run.sh
</code></pre></li><li><p>访问 license 页面： <code>http://服务器地址:30008</code> , 点击注册文件进行下载<br><img data-src="http://img.localhostes.com/images/2019/12/24/license.png" alt="license.png"></p></li><li><p>把下载的 cluster-blank.lic 给项目经理，进行授权</p></li><li><p>得到授权者提供的正式 license 文件后，将文件（通常为 lic 文件 ( <code>ttx.lic</code> )）放在 licenses 目录下</p><pre><code># 重启license服务
ps -ef | grep license
</code></pre><blockquote><p>通常输出如下：</p></blockquote><pre><code>ttx       9354     1  1 20:27 pts/1    00:00:15 /home/ttx/app/jre/bin/java -jar /home/ttx/app/license/upload/license.zip
ttx       9632  1277  0 20:42 pts/0    00:00:00 grep --color=auto java
</code></pre><blockquote><p>找到含有 license.zip 的进程，杀掉进程；比如上例中，进程 ID 为 9354</p></blockquote><pre><code># 将9354替换为实际的进程ID
sudo kill 9354
cd /home/ttx/app/license
./run.sh
</code></pre></li><li><p>访问 <code>http://服务器地址:30008</code> ，正常情况应显示服务器的 license 信息</p></li></ul><h3 id="jenkins构建"><a class="anchor" href="#jenkins构建">#</a> Jenkins 构建</h3><ul><li>进入 <code>Jenkins</code> 配置页面: <span class="exturl" data-url="aHR0cDovL2NpLml0dHguY29tLmNu">http://ci.ittx.com.cn</span> 进入对应文件夹 新建项目目录 (例如我的项目是 <code>xxx</code> )<br><img data-src="http://img.localhostes.com/images/2019/12/24/mainhtml.png" alt="mainhtml.png"><br><img data-src="http://img.localhostes.com/images/2019/12/24/dirs.png" alt="dirs.png"><br><img data-src="http://img.localhostes.com/images/2019/12/24/jenkinsdir.png" alt="jenkinsdir.png"></li></ul><blockquote><p>最后 save 保存就行</p></blockquote><ul><li>新建一个项目，这里可以直接复制已有的项目，先找到对应项目的路径。 比如 <code>ofs1_5</code> 的路径是这个 <code>xoms/OFS-1.5/ofs-1.5</code></li></ul><blockquote><p>新建项目，粘贴复制好的 <code>xoms/OFS-1.5/ofs-1.5</code></p></blockquote><p><img data-src="http://img.localhostes.com/images/2019/12/24/jenkinsitem.png" alt="jenkinsitem.png"><br><img data-src="http://img.localhostes.com/images/2019/12/23/jenkinscopy.png" alt="jenkinsitem.png"></p><blockquote><p>根据项目进行修改 <code>参与人</code> 以及对应的 <code>customerID</code> , 然后 <code>save</code> 即可</p></blockquote><p><img data-src="http://img.localhostes.com/images/2019/12/23/jenkinsedit1.png" alt="jenkinsitem.png"><br><img data-src="http://img.localhostes.com/images/2019/12/23/jenkinsedit2.png" alt="jenkinsitem.png"><br><img data-src="http://img.localhostes.com/images/2019/12/23/jenkinsedit3.png" alt="jenkinsitem.png"></p><ul><li>打包项目，获取对应的 <code>下载脚本</code></li></ul><p><img data-src="http://img.localhostes.com/images/2019/12/23/jenkinsscript1.png" alt="jenkinsitem.png"><br><img data-src="http://img.localhostes.com/images/2019/12/23/jenkinsscript2.png" alt="jenkinsitem.png"><br><img data-src="http://img.localhostes.com/images/2019/12/23/jenkinsscript3.png" alt="jenkinsitem.png"></p><ul><li>上传刚下载的 <code>update-xxx-xofs-test.sh</code> 到 <code>/home/ttx/app/tomcat-deploy</code></li><li>配置阿里 <code>oss</code> （可选：具体看项目是否支持）<ul><li>oss 地址：<span class="exturl" data-url="aHR0cHM6Ly90dHgtZG93bmxvYWQub3NzLWNuLWhhbmd6aG91LmFsaXl1bmNzLmNvbS9wcm9qZWN0cw==">https://ttx-download.oss-cn-hangzhou.aliyuncs.com/projects</span></li><li>修改 <code>update-xxx-xofs-test.sh</code> url <code>(https://release.cybertrans.ittx.com.cn)</code> 为 <code>oss地址</code><br><img data-src="http://img.localhostes.com/images/2019/12/23/oss.png" alt="jenkinsitem.png"></li></ul></li></ul><h3 id="ofs配置"><a class="anchor" href="#ofs配置">#</a> ofs 配置</h3><ul><li>执行数据库初始化脚本</li><li>上传 <code>application.yml、application-xxx.yml</code> 到 <code>/home/ttx/app/ofs/conf/default</code> 目录下<ul><li>注意: <code>xxx</code> 的取值为：<ul><li>正式服务器： <code>prod</code></li><li>测试服务器： <code>test</code></li></ul></li></ul></li><li>根据项目情况配置对应的 <code>mysql、redis、mongodb、rabbitmq</code> 链接</li><li>拉取 <code>Jenkins</code> 打好的包，编译并启动<pre><code>cd /home/ttx/app/tomcat-deploy
sh update-xxx-xofs-test.sh
</code></pre></li><li>启动完成之后检查日志输出是否正常， <code>ctrl + c</code> 退出查看模式<pre><code>tail -fn 100 /home/ttx/app/ofs1_5/catalina/9005/logs/catalina.out
</code></pre></li><li>启动成功，访问 <code>http://服务器地址:30001</code> 进行访问页面</li></ul><p><img data-src="http://img.localhostes.com/images/2019/12/23/main.png" alt="jenkinsitem.png"><br><img data-src="http://img.localhostes.com/images/2019/12/23/ofs.png" alt="jenkinsitem.png"></p><ul><li>启动、停止、编译、重启命令<pre><code>./app_start.sh ofs1_5
./app.stop.sh ofs1_5
./app_deploy.sh ofs1_5
./app_restart.sh ofs1_5
</code></pre></li></ul><h3 id="参考信息"><a class="anchor" href="#参考信息">#</a> 参考信息</h3><h4 id="系统目录"><a class="anchor" href="#系统目录">#</a> 系统目录</h4><pre><code>|-/
  |- home
    |- ttx
      |- installer
        |- images
        |- compose
      |- app
        |- redis
        |- mongo
        |- mysql
        |- rabbitMQ
        |- tomcat-deploy
        |- nginx
        |- license
        |- ofs1_5
        |- scheduler
        |- edi-qimen
        |- edi-taobao
</code></pre><h4 id="端口分配"><a class="anchor" href="#端口分配">#</a> 端口分配</h4><table><thead><tr><th style="text-align:center">服务</th><th style="text-align:center">端口</th><th style="text-align:center">备注</th></tr></thead><tbody><tr><td style="text-align:center">nginx</td><td style="text-align:center">80</td><td style="text-align:center">ofs 端口可转 80 端口</td></tr><tr><td style="text-align:center">mysql</td><td style="text-align:center">33306</td><td style="text-align:center">当 mysql 为通天晓安装时，必须修改端口号</td></tr><tr><td style="text-align:center">mongo</td><td style="text-align:center">37017</td><td style="text-align:center">生产服务器必须设定密码</td></tr><tr><td style="text-align:center">rabbitMQ</td><td style="text-align:center">35672</td><td style="text-align:center">mq 连接端口</td></tr><tr><td style="text-align:center">rabbitMQ-management</td><td style="text-align:center">35673</td><td style="text-align:center">消息队列管理可视化</td></tr><tr><td style="text-align:center">redis</td><td style="text-align:center">36379</td><td style="text-align:center">生产服务器必须设定密码</td></tr><tr><td style="text-align:center">ofs</td><td style="text-align:center">9005</td><td style="text-align:center">ofs 内部端口</td></tr><tr><td style="text-align:center">ofs</td><td style="text-align:center">30001</td><td style="text-align:center">ofs 外部端口</td></tr><tr><td style="text-align:center">scheduler</td><td style="text-align:center">30001</td><td style="text-align:center">使用到计划任务组件时使用</td></tr><tr><td style="text-align:center">license</td><td style="text-align:center">30008</td><td style="text-align:center">仅当授权服务部署在客户服务器时使用</td></tr><tr><td style="text-align:center">edi</td><td style="text-align:center">30012-30020</td><td style="text-align:center">多个端口为客户部署多套 edi 保留</td></tr></tbody></table><div class="tags"><a href="/tags/Linux/" rel="tag"><i class="ic i-tag"></i> Linux</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2019-12-25 12:24:04" itemprop="dateModified" datetime="2019-12-25T12:24:04+08:00">2019-12-25</time> </span><span id="ofs/" class="item leancloud_visitors" data-flag-title="ofs1.5 部署" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="vayi 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="vayi 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="vayi 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>vayi <i class="ic i-at"><em>@</em></i>Vayi</li><li class="link"><strong>本文链接：</strong> <a href="http://vayi.site/ofs/" title="ofs1.5 部署">http://vayi.site/ofs/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/proxy/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;picx.zhimg.com&#x2F;v2-304a00310f886e7f23b40d4e62a94dd6_r.jpg?source&#x3D;2c26e567" title="一个栗子搞懂代理模式"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 设计模式</span><h3>一个栗子搞懂代理模式</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%8E%A8%E8%8D%90"><span class="toc-number">1.</span> <span class="toc-text">服务器配置（推荐）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">服务器类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="toc-number">3.</span> <span class="toc-text">添加用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E7%9B%98"><span class="toc-number">4.</span> <span class="toc-text">挂载数据盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%9F%BA%E7%A1%80%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">5.</span> <span class="toc-text">安装基础运行环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">5.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85docker"><span class="toc-number">5.2.</span> <span class="toc-text">安装 docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85docker-compose"><span class="toc-number">5.3.</span> <span class="toc-text">安装 docker-compose</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mongo-rabbit-redis-mysql"><span class="toc-number">5.4.</span> <span class="toc-text">mongo、rabbit、redis、mysql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tomcat"><span class="toc-number">5.5.</span> <span class="toc-text">tomcat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nginx"><span class="toc-number">5.6.</span> <span class="toc-text">nginx</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E7%A8%8B%E5%BA%8F%E7%8E%AF%E5%A2%83"><span class="toc-number">6.</span> <span class="toc-text">准备程序环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85license%E6%9C%8D%E5%8A%A1"><span class="toc-number">7.</span> <span class="toc-text">安装 license 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jenkins%E6%9E%84%E5%BB%BA"><span class="toc-number">8.</span> <span class="toc-text">Jenkins 构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ofs%E9%85%8D%E7%BD%AE"><span class="toc-number">9.</span> <span class="toc-text">ofs 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E4%BF%A1%E6%81%AF"><span class="toc-number">10.</span> <span class="toc-text">参考信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%9B%AE%E5%BD%95"><span class="toc-number">10.1.</span> <span class="toc-text">系统目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%88%86%E9%85%8D"><span class="toc-number">10.2.</span> <span class="toc-text">端口分配</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/ofs/" rel="bookmark" title="ofs1.5部署">ofs1.5部署</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="vayi" data-src="/images/avatar.jpg"><p class="name" itemprop="name">vayi</p><div class="description" itemprop="description">vayi's blog~</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">11</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">7</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">10</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1lpYWljaGVu" title="https:&#x2F;&#x2F;github.com&#x2F;Yiaichen"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTI5ODUyNjU2OA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;298526568"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vdmF5aQ==" title="https:&#x2F;&#x2F;weibo.com&#x2F;vayi"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS9hbWVoaW1l" title="https:&#x2F;&#x2F;about.me&#x2F;amehime"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-user"></i>关于</a><ul class="submenu"><li class="item"><a href="/zishe/" rel="section"><i class="ic i-cloud"></i>自设</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-magic"></i>链环</a><ul class="submenu"><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/webstack/" rel="section"><i class="ic i-star"></i>网址</a></li></ul></li><li class="item"><span class="exturl" data-url="aHR0cHM6Ly90cmF2ZWxsaW5ncy5saW5r"><i class="ic i-paper-plane"></i>开往</span></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a></div><span><a href="/restructure/" title="重构 (附源码)">重构 (附源码)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hexo/" title="分类于 Hexo">Hexo</a></div><span><a href="/Hexo-gitment/" title="Hexo+gitment">Hexo+gitment</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="分类于 设计模式">设计模式</a></div><span><a href="/singleton/" title="一个栗子搞懂单例模式">一个栗子搞懂单例模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hexo/" title="分类于 Hexo">Hexo</a></div><span><a href="/Github+Hexo/" title="Github+Hexo">Github+Hexo</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a></div><span><a href="/dom4j/" title="Java读取xml——dom4j篇">Java读取xml——dom4j篇</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a></div><span><a href="/semaphore/" title="Semaphore深入浅出">Semaphore深入浅出</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Mysql/" title="分类于 Mysql">Mysql</a></div><span><a href="/mysqlInstall/" title="windows安装mysql（version:5.6.17）">windows安装mysql（version:5.6.17）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="分类于 Linux">Linux</a></div><span><a href="/ofs/" title="ofs1.5部署">ofs1.5部署</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="分类于 设计模式">设计模式</a></div><span><a href="/proxy/" title="一个栗子搞懂代理模式">一个栗子搞懂代理模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MYSQL/" title="分类于 MYSQL">MYSQL</a></div><span><a href="/MYSQL_LOCK/" title="MYSQL锁以及死锁的产生跟解决">MYSQL锁以及死锁的产生跟解决</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">vayi @ Vayi Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">41k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">37 分钟</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"ofs/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/assets/shizuku.model.json"},"display":{"position":"left","width":90,"height":150,"bottom":-30},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>